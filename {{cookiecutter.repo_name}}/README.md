![](docs/images/CompanyLogo.png)
>   *This repo structure has been autogenerated from [Intellectual Labs cookiecutter template](https://github.com/IntellectualLabs/data_science_template).
Feel free to change the company logo under `docs/images/CompanyLogo.png`*

# {{cookiecutter.project_name}}

{{cookiecutter.project_description}}

*Explain the purpose of your repository/project here*


## Setup

1. Install git and checkout the [git code repository]
2. Install [anaconda] python version 3.6+
3. Change working directory into the git code repository root
4. Create the self contained conda environment;
    - Add other necessary packages to `conda_env.yml` under dependencies.
    - Go to the git code repository root and enter the command:

        ```bash
        conda env create --file conda_env.yml
        ```

    - Activate the conda environment:

        ```bash
        conda activate {{cookiecutter.project_name.lower().replace(' ', '_')}}
        ```

    - To make the environment available as a kernel in Jupyter notebook,
      install an ipython kernel by

        ```bash
        python -m ipykernel install --user --name {{cookiecutter.project_name.lower().replace(' ', '_')}} --display-name "Python ({{cookiecutter.project_name.lower().replace(' ', '_')}})"
        ```

5. Any python modules under folder `src/` need to be available to other scripts.
Install the module locally (in developer mode) in your conda environment with modifications
reflected immediately:

    ```bash
   pip install -e .
    ```


## Run API

To run the API in `application/app.py`, with `root` as working directory run:

```bash
(cd application/ && uvicorn app:app --reload --port 4242)
```

This will run the server and host the api locally on port 4242;
go to http://127.0.0.1:4242/ in your browser.

The API is built using `fastapi` (see [docs](https://fastapi.tiangolo.com/))
which autogenerates API documentation with both Swagger and ReDoc;

1. For Swagger UI API documentation go to http://127.0.0.1:4242/docs
2. For ReDoc UI API documentation go to http://127.0.0.1:4242/redoc

## Run API in docker

1. Install [Docker](https://www.docker.com/products/docker-desktop)
2. With `root` as working directory, build docker image by:
    ```bash
    docker build -t {{cookiecutter.project_name.lower().replace(' ', '_')}} .
    ```
    Note that this can take several minutes.
3. Spin up a docker container by:
    ```bash
    docker run -it -d --name {{cookiecutter.project_name.lower().replace(' ', '_')}}_api -p 4242:80 {{cookiecutter.project_name.lower().replace(' ', '_')}}
    ```
    This will spin up a container named `{{cookiecutter.project_name.lower().replace(' ', '_')}}_api` which runs the API available at port 4242.
4. To check that the API is up go to http://127.0.0.1:4242/docs (Swagger UI API documentation).

**Tips:** To enter (SSH into) the terminal of the running container:
```bash
docker exec -it {{cookiecutter.project_name.lower().replace(' ', '_')}}_api /bin/bash
```

## Testing

Reproducability and the correct functioning of code are essential to avoid wasted time.
If a code block is copied more than once then it should be placed into a
common script / module under `src/` and unit tests added. The same applies for
any other non trivial code to ensure the correct functioning.

To run tests, install `pytest` using pip or conda (should have been setup already if
you used the `conda_env.yml` file) and then from the repository root run

```bash
pytest --cov
```

This will also display test coverage.


## Automated Document Generation

A [sphinx](https://www.sphinx-doc.org/) project is provided under `docs/writeup/` that will generate writeup that
also includes automatically generated API information for any packages. The output can be created in multiple
formats including html and pdf. If you are using CI then this can be run automatically.
To run locally execute the following commands:

```bash
cd docs/writeup
make html
```

On Windows this will run the `make.bat`, a Makefile is also included for those using the `make` command.

## References

* https://github.com/IntellectualLabs/data_science_template
* http://docs.python-guide.org/en/latest/writing/structure/
* https://intellectuallabs.no/


[//]: #
   [anaconda]: <https://www.continuum.io/downloads>
